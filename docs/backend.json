{
  "entities": {
    "Reward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reward",
      "type": "object",
      "description": "Represents a reward that can be redeemed with points.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reward."
        },
        "name": {
          "type": "string",
          "description": "The name of the reward."
        },
        "description": {
          "type": "string",
          "description": "A description of the reward."
        },
        "pointsCost": {
          "type": "number",
          "description": "The number of points required to redeem the reward."
        },
        "imageUrl": {
          "type": "string",
          "description": "A URL for an image of the reward."
        }
      },
      "required": [
        "id",
        "name",
        "pointsCost"
      ]
    },
    "Referral": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Referral",
      "type": "object",
      "description": "Represents a referral record in the system, tracking shares and associated UTM parameters.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the referral record."
        },
        "referrerId": {
          "type": "string",
          "description": "Reference to the User who initiated the referral. (Relationship: User 1:N Referral)"
        },
        "referredUserId": {
          "type": "string",
          "description": "Reference to the User who was referred. (Relationship: User 1:N Referral)"
        },
        "shareDate": {
          "type": "string",
          "description": "Date and time when the referral was initiated.",
          "format": "date-time"
        },
        "utmSource": {
          "type": "string",
          "description": "UTM source parameter for tracking the origin of the referral."
        },
        "utmMedium": {
          "type": "string",
          "description": "UTM medium parameter for tracking the marketing medium used for the referral."
        },
        "utmCampaign": {
          "type": "string",
          "description": "UTM campaign parameter for tracking the specific campaign associated with the referral."
        },
        "utmTerm": {
          "type": "string",
          "description": "UTM term parameter for tracking the keywords used in the referral."
        },
        "utmContent": {
          "type": "string",
          "description": "UTM content parameter for differentiating ads or links in the referral."
        }
      },
      "required": [
        "id",
        "referrerId",
        "shareDate"
      ]
    },
    "Point": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Point",
      "type": "object",
      "description": "Represents a record of points earned or spent by a user, along with associated reward history and user tier.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the point record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns these points. (Relationship: User 1:N Point)"
        },
        "pointsEarned": {
          "type": "number",
          "description": "Number of points earned in this record."
        },
        "pointsSpent": {
          "type": "number",
          "description": "Number of points spent in this record."
        },
        "transactionDate": {
          "type": "string",
          "description": "Date and time of the point transaction.",
          "format": "date-time"
        },
        "rewardId": {
          "type": "string",
          "description": "Reference to the Reward associated with this point transaction. (Relationship: Reward 1:N Point).  Can be null if points are not associated with a specific reward."
        },
        "userTier": {
          "type": "string",
          "description": "User's current tier (e.g., Bronze, Silver, Gold) based on their points balance."
        },
        "description": {
          "type": "string",
          "description": "Description of the reward."
        }
      },
      "required": [
        "id",
        "userId",
        "pointsEarned",
        "pointsSpent",
        "transactionDate"
      ]
    },
    "InboxMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inbox Message",
      "type": "object",
      "description": "Represents a message within the shared inbox.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "userId": {
          "type": "string",
          "description": "ID of the user associated with the message (sender or recipient)."
        },
        "channel": {
          "type": "string",
          "description": "The communication channel (e.g., 'whatsapp', 'email')."
        },
        "content": {
          "type": "string",
          "description": "The content of the message."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the message was sent or received."
        },
        "isRead": {
          "type": "boolean",
          "description": "Flag indicating if the message has been read."
        }
      },
      "required": [
        "id",
        "userId",
        "channel",
        "content",
        "timestamp"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a social media post to be managed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this post."
        },
        "content": {
          "type": "string",
          "description": "The text content of the post."
        },
        "scheduledAt": {
          "type": "string",
          "format": "date-time",
          "description": "The scheduled time for posting."
        },
        "status": {
          "type": "string",
          "enum": [
            "draft",
            "scheduled",
            "published"
          ],
          "description": "The current status of the post."
        }
      },
      "required": [
        "id",
        "userId",
        "content",
        "status"
      ]
    },
    "SocialMediaAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Social Media Account",
      "type": "object",
      "description": "Represents a user's linked social media account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the social media account link."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this account link."
        },
        "platform": {
          "type": "string",
          "enum": [
            "Twitter",
            "LinkedIn",
            "Facebook",
            "Instagram"
          ],
          "description": "The social media platform."
        },
        "handle": {
          "type": "string",
          "description": "The user's handle or username on the platform."
        },
        "accessToken": {
          "type": "string",
          "description": "The OAuth access token for API access (should be encrypted)."
        }
      },
      "required": [
        "id",
        "userId",
        "platform",
        "handle"
      ]
    },
    "Template": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Template",
      "type": "object",
      "description": "Represents a design template for a digital card.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the template."
        },
        "name": {
          "type": "string",
          "description": "The name of the template."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the template."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL for a preview image of the template."
        },
        "styleData": {
          "type": "object",
          "description": "A JSON object containing the styling information for the template."
        }
      },
      "required": [
        "id",
        "name",
        "styleData"
      ]
    },
    "Analytics": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Analytics",
      "type": "object",
      "description": "Represents an analytics event for a user's card.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the analytics event."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user whose card generated the event."
        },
        "eventType": {
          "type": "string",
          "enum": [
            "cardView",
            "linkClick",
            "share"
          ],
          "description": "The type of event that occurred."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the event occurred."
        },
        "details": {
          "type": "object",
          "description": "Additional details about the event (e.g., which link was clicked)."
        }
      },
      "required": [
        "id",
        "userId",
        "eventType",
        "timestamp"
      ]
    },
    "AIUsage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AI Usage",
      "type": "object",
      "description": "Represents a record of AI feature usage by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI usage record."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who used the AI feature."
        },
        "feature": {
          "type": "string",
          "enum": [
            "copilot",
            "ocr",
            "logo",
            "background"
          ],
          "description": "The AI feature that was used."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the feature was used."
        },
        "creditsConsumed": {
          "type": "number",
          "description": "The number of AI credits consumed by the operation."
        }
      },
      "required": [
        "id",
        "userId",
        "feature",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/points/{pointId}",
        "definition": {
          "entityName": "Point",
          "schema": {
            "$ref": "#/backend/entities/Point"
          },
          "description": "Stores point records for each user. Path-based ownership ensures only the user can access their own points. Includes userId to support authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the points."
            },
            {
              "name": "pointId",
              "description": "The ID of the point record."
            }
          ]
        }
      },
      {
        "path": "/referrals/{referralId}",
        "definition": {
          "entityName": "Referral",
          "schema": {
            "$ref": "#/backend/entities/Referral"
          },
          "description": "Stores referral records, including UTM parameters. `referrerId` and `referredUserId` are stored within each document to support authorization independence.",
          "params": [
            {
              "name": "referralId",
              "description": "The ID of the referral record."
            }
          ]
        }
      },
      {
        "path": "/inbox_messages/{messageId}",
        "definition": {
          "entityName": "InboxMessage",
          "schema": {
            "$ref": "#/backend/entities/InboxMessage"
          },
          "description": "Stores messages from various channels for the shared inbox feature.",
          "params": [
            {
              "name": "messageId",
              "description": "The unique ID of the message."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores user-created posts for social media management.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the post."
            },
            {
              "name": "postId",
              "description": "The unique ID of the post."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/social_media_accounts/{accountId}",
        "definition": {
          "entityName": "SocialMediaAccount",
          "schema": {
            "$ref": "#/backend/entities/SocialMediaAccount"
          },
          "description": "Stores user's linked social media accounts.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the account link."
            },
            {
              "name": "accountId",
              "description": "The unique ID of the linked account."
            }
          ]
        }
      },
      {
        "path": "/templates/{templateId}",
        "definition": {
          "entityName": "Template",
          "schema": {
            "$ref": "#/backend/entities/Template"
          },
          "description": "Stores publicly available card templates.",
          "params": [
            {
              "name": "templateId",
              "description": "The unique ID of the template."
            }
          ]
        }
      },
      {
        "path": "/rewards/{rewardId}",
        "definition": {
          "entityName": "Reward",
          "schema": {
            "$ref": "#/backend/entities/Reward"
          },
          "description": "Stores publicly available rewards that can be redeemed with points.",
          "params": [
            {
              "name": "rewardId",
              "description": "The unique ID of the reward."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/analytics/{analyticId}",
        "definition": {
          "entityName": "Analytics",
          "schema": {
            "$ref": "#/backend/entities/Analytics"
          },
          "description": "Stores analytics events for a user's card.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the card."
            },
            {
              "name": "analyticId",
              "description": "The unique ID of the analytics event."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/ai_usage/{usageId}",
        "definition": {
          "entityName": "AIUsage",
          "schema": {
            "$ref": "#/backend/entities/AIUsage"
          },
          "description": "Stores records of AI feature usage for a user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who used the feature."
            },
            {
              "name": "usageId",
              "description": "The unique ID of the usage record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Mshkur AI Studio application, focusing on user-owned data and collaborative features like the viral referral system. Authorization Independence is achieved by storing user IDs directly within the `referrals` and `points` collections. \n\n*   **User Data Segregation:** User-specific data (points, posts, social_media_accounts, analytics, ai_usage) is stored under `/users/{userId}` to ensure only the user has access.\n*   **Referral Data:** Referrals are stored in a top-level `/referrals` collection, avoiding hierarchical dependencies. The `referrerId` and `referredUserId` are stored within each referral document, providing authorization independence.\n* **Shared Inbox:** Messages are stored in a top-level `/inbox_messages` collection for the shared inbox feature.\n* **Public Templates & Rewards:** Templates and Rewards are stored in top-level collections (`/templates`, `/rewards`) to make them publicly readable.\n\nThis structure facilitates simple and robust security rules by avoiding `get()` calls and enabling secure list operations (QAPs) by scoping user data under their respective user IDs and providing flat collections for public or semi-public data."
  }
}

    